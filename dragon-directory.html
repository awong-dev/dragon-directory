<!DOCTYPE html>
<html>
<head>
<title>Dragon Directory Maker</title>
<script type="module" src="dragon-directory.js"></script>
<script>
  function renderStudents(raw_csv) {
    const students = dragonDirectory.extract_to_students(raw_csv);
    const groups = dragonDirectory.group_students(students);
    const output_table = document.getElementById('student_table');
    for (const [k,v] of Object.entries(groups.by_teacher)) {
      const g_el = document.createElement('section');

      // Add group header.
      const h2 = document.createElement('h2');
      h2.innerText = `${v[0].teacher} - Grade ${v[0].grade}`;
      g_el.appendChild(h2);

      // Add students header.
      for (const s of v) {
        if (s.in_dragon_directory) {
          for (const p of s.parents) {
            const parent_el = document.createElement('p');
            parent_el.innerText = `${s.student_name} - ${p.parent_name} / ${p.email} / ${p.phone}`;
            g_el.appendChild(parent_el);
          }
        }
      }

      output_table.appendChild(g_el);
    }
  }

  addEventListener("load", (event) => {
    document.getElementById('csv').addEventListener('change', function(e) {
      if (e.target.files[0]) {
        const reader = new FileReader();
        reader.addEventListener("load",
            () => renderStudents(reader.result),
            false
        );
        reader.readAsText(e.target.files[0]);
      }
    });
  });
</script>
</head>
<body>
<label for="csv">CSV File</label>
<input type="file" id="csv" name="csv" accept="text/csv"></input>
<hr />
<div id="student_table"></div>
</body>
</html>
